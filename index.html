<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Brankas.</title>
    <!-- CDN (Bootstrap 5) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- CDN (FontAwesome) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- CDN (DataTables) -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.min.css">

    <style type="text/css">
    	label {
    		margin-left: 5px;
    	}
    </style>
  </head>
  <body>

  	<!-- Brankas. -->
    <div class="container mt-3 mb-3">
    	<div class="row">
    		<div class="col-lg-12">
    			<!-- Brand -->
    			<div class="text-center">
    				<h2><i class="fas fa-landmark"></i>&nbsp; Brankas.</h2>
    				<p class="text-muted">Rahasiakan asetmu dari petugas pajak!</p>
    			</div>
    			<!-- Informasi Keuangan -->
    			<div class="row mt-4 mb-3">
    				<div class="col-lg-12">
    					<div class="alert alert-primary">
    						<h3 class="text-center fw-bold" id="saldo">Rp. 100.000,-</h3>
    						<p class="text-center text-muted"><i class="fas fa-wallet"></i>&nbsp; Saldo kamu</p>
    					</div>
    				</div>
    				<div class="col-lg-6">
    					<div class="alert alert-success">
    						<h3 class="text-center fw-bold" id="pemasukan">Rp. 100.000,-</h3>
    						<p class="text-center text-muted"><i class="fas fa-hand-holding-usd"></i>&nbsp; Pemasukan</p>
    					</div>
    				</div>
    				<div class="col-lg-6">
    					<div class="alert alert-danger">
    						<h3 class="text-center fw-bold" id="pengeluaran">Rp. 0,-</h3>
    						<p class="text-center text-muted"><i class="fas fa-receipt"></i>&nbsp; Pengeluaran</p>
    					</div>
    				</div>
    			</div>
    			<!-- Tabel Riwayat Transaksi -->
    			<div class="row mt-3 mb-4">
    				<div class="col-lg-12">
    					<div class="card">
    						<div class="card-header">
    							<h3 class="text-center mt-1"><i class="fas fa-stamp"></i>&nbsp; Riwayat Transaksi Kamu</h3>
    						</div>
    						<div class="card-body">
    							<div class="mb-3">
    								<button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#tambahTransaksi"><i class="fas fa-plus"></i>&nbsp; Tambah Transaksi</button>
    							</div>
    							<table id="tabel" class="table table-striped table-bordered" style="width: 100%">
    								<thead>
    									<tr>
    										<th><center><i class="fas fa-calendar-alt"></i>&nbsp; Tgl. Transaksi</center></th>
    										<th><center><i class="fas fa-info-circle"></i>&nbsp; Keterangan</center></th>
    										<th><center><i class="fas fa-money-bill-alt"></i>&nbsp; Nominal</center></th>
    										<th><center><i class="fas fa-money-check"></i>&nbsp; Kategori</center></th>
    									</tr>
    								</thead>
    							</table>
    						</div>
    					</div>
    				</div>
    			</div>
    		</div>
    	</div>
    </div>

    <!-- Modal (Tambah Transaksi) -->
	<div class="modal fade" id="tambahTransaksi" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h1 class="modal-title fs-5" id="exampleModalLabel"><i class="fas fa-plus"></i>&nbsp; Tambah Transaksi</h1>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">
	      	<form id="transaksi">
	      		<div class="form-group mb-3">
		        	<label for="tgl" class="form-label"><i class="fas fa-calendar-alt"></i>&nbsp; Tgl. Transaksi</label>
		        	<input type="date" min="" onfocus="this.min = new Date().toISOString().split('T')[0]" name="tgl" id="tgl" class="form-control" placeholder="Masukkan keterangan transaksi" required>
		        </div>
		        <div class="form-group mb-3">
		        	<label for="kategori" class="form-label"><i class="fas fa-money-check"></i>&nbsp; Kategori</label>
		        	<select name="kategori" id="kategori" class="form-control" required>
		        		<option disabled>--- Silahkan pilih ---</option>
		        		<option value="Pemasukan">Pemasukan</option>
		        		<option value="Pengeluaran">Pengeluaran</option>
		        	</select>
		        </div>
		        <div class="form-group mb-3">
		        	<label for="keterangan" class="form-label"><i class="fas fa-info-circle"></i>&nbsp; Keterangan</label>
		        	<input type="text" name="keterangan" id="keterangan" class="form-control" placeholder="Masukkan keterangan transaksi" required>
		        </div>
		        <div class="form-group mb-3">
		        	<label for="nominal" class="form-label"><i class="fas fa-money-bill-alt"></i>&nbsp; Nominal</label>
		        	<input type="number" name="nominal" id="nominal" class="form-control" placeholder="Masukkan nominal transaksi" required>
		        </div>
	      </div>
	      <div class="modal-footer">
	      	<button type="submit" class="btn btn-success"><i class="fas fa-stamp"></i>&nbsp; Simpan</button>
	      	</form>
	        <button type="button" class="btn btn-danger" data-bs-dismiss="modal"><i class="fas fa-times"></i>&nbsp; Tutup</button>
	      </div>
	    </div>
	  </div>
	</div>

    <!-- CDNJS (Bootstrap 5) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- CDNJS (DataTables) -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/2.2.2/js/dataTables.min.js"></script>
    <script type="text/javascript">
    	$(document).ready(function() {
    		$('#tabel').DataTable({
    			order: []
    		});
    	});
    </script>

    <script type="text/javascript">
    	$(document).ready(function () {
	    let table = $('#tabel').DataTable();

	    function hitungSaldo() {
	        let data   	    = JSON.parse(localStorage.getItem("dataTransaksi")) || [];
	        let saldo       = 0;
	        let pemasukan   = 0;
	        let pengeluaran = 0;

	        data.forEach((item) => {
	            let nominal = parseInt(item.nominal, 10);
	            if (item.kategori === "Pemasukan") {
	                pemasukan += nominal;
	            } else {
	                pengeluaran += nominal;
	            }
	        });

	        saldo = pemasukan - pengeluaran;

	        $("#saldo").html(`Rp. ${saldo.toLocaleString("id-ID")},-`);
	        $("#pemasukan").html(`Rp. ${pemasukan.toLocaleString("id-ID")},-`);
	        $("#pengeluaran").html(`Rp. ${pengeluaran.toLocaleString("id-ID")},-`);

	        return saldo;
	    }

	    function tampilkanTransaksi() {
	        table.clear().draw();

	        let data = JSON.parse(localStorage.getItem("dataTransaksi")) || [];

	        data.sort(function(a, b) {
	        	return new Date(b.tgl) - new Date(a.tgl);
	        });

	        data.forEach((item) => {
	            table.row.add([
	                `<center>${item.tgl}</center>`,
	                `<center>${item.keterangan}</center>`,
	                `<center>Rp. ${parseInt(item.nominal, 10).toLocaleString("id-ID")},-</center>`,
	                `<center>${item.kategori}</center>`
	            ]).draw(false);
	        });

	        hitungSaldo();
	    }

	    $("#transaksi").submit(function (event) {
	        event.preventDefault();

	        let tgl   	   = $("#tgl").val();
	        let kategori   = $("#kategori").val();
	        let keterangan = $("#keterangan").val();
	        let nominal    = parseInt($("#nominal").val(), 10); // âœ… Pastikan parsing angka

	        if (isNaN(nominal) || nominal <= 0) {
	            alert("Nominal harus lebih dari 0!");
	            return;
	        }

	        let saldoSaatIni = hitungSaldo();

	        if (kategori === "Pengeluaran" && nominal > saldoSaatIni) {
	            alert("Pengeluaran tidak boleh melebihi saldo saat ini!");
	            return;
	        }

	        let data = JSON.parse(localStorage.getItem("dataTransaksi")) || [];
	        data.push({ tgl, kategori, keterangan, nominal });
	        localStorage.setItem("dataTransaksi", JSON.stringify(data));

	        $("#transaksi")[0].reset();
	        tampilkanTransaksi();

	        let modal = bootstrap.Modal.getInstance(document.getElementById("tambahTransaksi"));
	        modal.hide();

	        window.history.replaceState(null, null, window.location.pathname);
	    });

	    tampilkanTransaksi();
	});

    // security
    document.addEventListener('contextmenu', function(e) {
	    e.preventDefault();
	});

    document.onkeydown = function (e) {
	    // Detecting Ctrl + U (view source) and F12 (developer tools)
	    if (e.ctrlKey && (e.key === 'u' || e.key === 'U')) {
	        e.preventDefault();
	        window.location.href = "https://rizzportfolio.vercel.app";
	    }
	    if (e.key === 'F12') {
	        e.preventDefault();
	        window.location.href = "https://rizzportfolio.vercel.app";
	    }
	    
	    // dev tools
	    var devtools = /./;
		devtools.toString = function() {
		    window.location.href = "https://rizzportfolio.vercel.app";
		};

		setInterval(function() {
		    console.log(devtools);
		}, 1000);
	};

    </script>
  </body>

</html>
